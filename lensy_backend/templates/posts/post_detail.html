{% extends "base.html" %}
{% block content %}

<div class="container my-4">

    <div class="row align-items-stretch">

        <!-- ====== STRZA≈ÅKA: STARSZY POST ====== -->
        <div class="col-1 d-flex align-items-center justify-content-center">
        {% if next_post %}
            <a href="{{ next_post.get_absolute_url }}"
            class="btn btn-outline-secondary"
            title="Nowszy post">
                &lt;
            </a>
        {% endif %}
    </div>

        <!-- ====== ZDJƒòCIE ====== -->
        <div class="col-md-6 bg-dark d-flex align-items-center justify-content-center rounded-start">
            <img src="{{ post.image.url }}" class="img-fluid">
        </div>

        <!-- ====== PRAWA SEKCJA ====== -->
        <div class="col-md-4 d-flex flex-column p-3 border">

            <!-- ====== G√ìRA ====== -->
            <div class="d-flex align-items-center justify-content-between mb-2">
                <div class="d-flex align-items-center gap-2">
                    {% if post.author.avatar %}
                        <img src="{{ post.author.avatar.url }}"
                             class="rounded-circle"
                             width="40" height="40">
                    {% endif %}
                    <strong>{{ post.author.username }}</strong>
                </div>

                {% if request.user != post.author %}
                    <a href="#" class="btn btn-sm btn-outline-primary">
                        Obserwuj
                    </a>
                {% endif %}
            </div>

            <!-- ====== OPIS ====== -->
            {% if post.description %}
                <p class="mb-1">{{ post.description }}</p>
            {% endif %}

            <!-- ====== HASHTAGI ====== -->
            <div class="mb-1">
                {% for tag in post.hashtags.all %}
                    <span class="text-primary">#{{ tag.name }}</span>
                {% endfor %}
            </div>

            <hr class="my-1">

            <!-- ====== KOMENTARZE ====== -->
            <div class="flex-grow-1 overflow-auto" style="max-height: 55vh;">

                {% for comment in post.comments.all %}
                    {% if not comment.parent %}
                        <div class="d-flex justify-content-between align-items-start mb-2">

                            <!-- LEWA -->
                            <div style="max-width:85%; word-wrap:break-word;">
                                <div>
                                    <strong>{{ comment.user.username }}</strong>
                                    {{ comment.content }}
                                </div>

                                <div class="text-muted small">
                                    {{ comment.created_at|date:"d.m.Y H:i" }}
                                    ¬∑ ‚ù§Ô∏è {{ comment.likes.count }}
                                </div>
                            </div>

                            <!-- PRAWA ‚Äì LIKE -->
                            <form method="post"
                                  action="{% url 'toggle_comment_like' comment.id %}">
                                {% csrf_token %}
                                <button class="btn btn-sm
                                    {% if comment.id in liked_comment_ids %}
                                        btn-danger
                                    {% else %}
                                        btn-outline-danger
                                    {% endif %}">
                                    ‚ù§Ô∏è
                                </button>
                            </form>

                        </div>
                    {% endif %}
                {% empty %}
                    <p class="text-muted">Brak komentarzy</p>
                {% endfor %}

            </div>

            <!-- ====== INFO POSTA + LIKE ====== -->
            <div class="d-flex align-items-center justify-content-between mt-1 mb-1">

                <div class="text-muted small">
                    ‚ù§Ô∏è {{ post.likes.count }}
                    ¬∑ üí¨ {{ post.comments.count }}
                    ¬∑ {{ post.created_at|date:"d.m.Y H:i" }}
                </div>

                <form method="post" action="{% url 'toggle_like' post.id %}">
                    {% csrf_token %}
                    <button class="btn btn-sm
                        {% if is_liked %}
                            btn-danger
                        {% else %}
                            btn-outline-danger
                        {% endif %}">
                        ‚ù§Ô∏è
                    </button>
                </form>

            </div>

            <hr class="my-1">

            <!-- ====== DODAJ KOMENTARZ ====== -->
            <form method="post"
                  action="{% url 'add_comment' post.id %}"
                  class="d-flex gap-2">
                {% csrf_token %}
                <input type="text"
                       name="content"
                       class="form-control"
                       placeholder="Dodaj komentarz...">
                <button class="btn btn-primary">Dodaj</button>
            </form>

        </div>

        <!-- ====== STRZA≈ÅKA: NOWSZY POST ====== -->
        <div class="col-1 d-flex align-items-center justify-content-center">
            {% if previous_post %}
                <a href="{{ previous_post.get_absolute_url }}"
                class="btn btn-outline-secondary"
                title="Starszy post">
                    &gt;
                </a>
            {% endif %}
        </div>

    </div>

    <!-- ====== POWR√ìT ====== -->
    <div class="mt-3">
        <a href="javascript:history.back()" class="btn btn-outline-secondary w-100">
            ‚¨Ö Powr√≥t
        </a>
    </div>

</div>

{% endblock %}
