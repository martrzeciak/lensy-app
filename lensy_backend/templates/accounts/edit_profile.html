{% extends "base.html" %}
{% block title %}Edytuj profil{% endblock %}

{% block content %}
<div class="card p-4">

    <h4 class="mb-4 text-center">Edytuj profil</h4>

    <!-- AVATAR -->


    <!-- AVATAR + KONTO -->
    <div class="row align-items-start mb-4">

        <!-- AVATAR -->
        <div class="col-md-6">

            <div class="row align-items-center">

                <!-- PODGLĄD -->
                <div class="col-md-4 text-center">
                    {% if request.user.avatar %}
                        <img src="{{ request.user.avatar.url }}"
                            class="rounded-circle"
                            width="120"
                            height="120">
                    {% else %}
                        <div class="rounded-circle bg-secondary d-flex
                                    align-items-center justify-content-center"
                            style="width:120px;height:120px;">
                            <span class="text-light">Brak</span>
                        </div>
                    {% endif %}
                </div>

                <!-- AKCJE -->
                <div class="col-md-8">
                    <label class="form-label fw-bold">Avatar</label>

                    <!-- ZMIEŃ AVATAR -->
                    <form id="avatarForm"
                        method="post"
                        action="{% url 'update_avatar' %}"
                        enctype="multipart/form-data"
                        class="d-inline">
                        {% csrf_token %}

                        <input type="file"
                            name="avatar"
                            id="avatarInput"
                            accept="image/*"
                            hidden
                            onchange="document.getElementById('avatarForm').submit()">

                        <button type="button"
                                class="btn btn-sm btn-outline-primary"
                                onclick="document.getElementById('avatarInput').click()">
                            Zmień avatar
                        </button>
                    </form>

                    <!-- USUŃ AVATAR -->
                    {% if request.user.avatar %}
                        <form method="post"
                            action="{% url 'remove_avatar' %}"
                            class="d-inline">
                            {% csrf_token %}
                            <button class="btn btn-sm btn-outline-danger">
                                Usuń avatar
                            </button>
                        </form>
                    {% endif %}
                </div>

            </div>
        </div>

        <!-- ====== KONTO ====== -->
        <div class="col-md-6">

            <label class="form-label fw-bold me-2">Konto</label>

            <button id="toggleDeleteBtn"
                    class="btn btn-sm btn-outline-danger mb-2">
                Usuń
            </button>

            <div id="deleteConfirmBox"
                style="display:none;"
                class="border rounded p-3 mt-2">

                <p class="text-danger mb-3">
                    Czy jesteś pewny, że chcesz usunąć konto?
                </p>

                <form method="post"
                    action="{% url 'delete_account' %}">
                    {% csrf_token %}

                    <button class="btn btn-danger btn-sm">
                        Usuń konto
                    </button>
                </form>
            </div>

        </div>

    </div>

    <!-- RESZTA FORMULARZA -->
    <form method="post">
        {% csrf_token %}

        <div class="row mb-3">
            <div class="col-md-4">
                {{ form.username.label_tag }}
                {{ form.username }}
            </div>
            <div class="col-md-4">
                {{ form.first_name.label_tag }}
                {{ form.first_name }}
            </div>
            <div class="col-md-4">
                {{ form.last_name.label_tag }}
                {{ form.last_name }}
            </div>
        </div>

        <div class="mb-4">
            {{ form.bio.label_tag }}
            {{ form.bio }}
        </div>

        <div class="d-flex gap-2">
            <button class="btn btn-success w-50">
                Zapisz
            </button>
            <a href="{% url 'profile' %}"
               class="btn btn-outline-secondary w-50">
                Anuluj
            </a>
        </div>
    </form>

</div>

<script>
document.addEventListener('DOMContentLoaded', function () {

    const toggleBtn = document.getElementById('toggleDeleteBtn');
    const box = document.getElementById('deleteConfirmBox');

    toggleBtn.addEventListener('click', () => {
        const isVisible = box.style.display === 'block';

        box.style.display = isVisible ? 'none' : 'block';
        toggleBtn.textContent = isVisible ? 'Usuń' : 'Ukryj';
    });

});
</script>


{% endblock %}
